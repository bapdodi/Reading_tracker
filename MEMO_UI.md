# 오늘의 흐름 UI/UX 구현 가이드

## 1. 개요

이 문서는 "오늘의 흐름" 기능의 프론트엔드 구현 가이드입니다. 
백엔드 API는 `MEMO_FEATURE_IMPLEMENTATION_PLAN.md`를 참조하세요.

**참고**: 노션 문서 (https://www.notion.so/2994a8c85009811497c9cde5714029ed?p=29c4a8c8500980d29a14eb07ba876688&pm=s)

---

## 2. 화면 구성

### 2.1 메인 화면: 오늘의 흐름

#### 2.1.1 기본 레이아웃
```
┌─────────────────────────────────────────────────┐
│  오늘의 흐름                          [날짜 선택] │
├─────────────────────────────────────────────────┤
│  [타임라인] [책별]  [필터: 전체] [정렬: 시간순]  │
├─────────────────────────────────────────────────┤
│                                                  │
│  ┌──────────────────────────────────────────┐  │
│  │ 📖 책 제목 1                              │  │
│  │ 10:30 AM  |  페이지 15                    │  │
│  │ ────────────────────────────────────────  │  │
│  │ 메모 내용이 여기에 표시됩니다...          │  │
│  │ [태그1] [태그2]                           │  │
│  │ [수정] [삭제]                             │  │
│  └──────────────────────────────────────────┘  │
│                                                  │
│  ┌──────────────────────────────────────────┐  │
│  │ 📖 책 제목 2                              │  │
│  │ 11:15 AM  |  페이지 42                    │  │
│  │ ────────────────────────────────────────  │  │
│  │ 메모 내용...                              │  │
│  │ [태그3]                                   │  │
│  │ [수정] [삭제]                             │  │
│  └──────────────────────────────────────────┘  │
│                                                  │
│  [+ 메모 작성하기]                              │
└─────────────────────────────────────────────────┘
```

#### 2.1.2 화면 요소

**헤더 영역:**
- 제목: "오늘의 흐름"
- 날짜 선택 버튼 (캘린더 아이콘)
  - 클릭 시 날짜 선택 모달 표시
  - 기본값: 오늘 날짜

**필터/정렬 영역:**
- 정렬 기준 선택: [타임라인] [책별]
  - 기본값: 타임라인
  - 타임라인: 시간 순서대로 정렬 (가장 오래된 메모가 위)
  - 책별: 책별로 그룹화 후 시간 순서대로 정렬
- 필터: [전체] [책 선택]
  - 특정 책의 메모만 표시
- 정렬: [시간순] [페이지순] (책별 보기 시)

**메모 카드:**
- 책 정보: 책 제목, 표지 이미지 (선택)
- 메모 정보: 작성 시간, 페이지 수
- 메모 내용: 텍스트 (최대 5000자)
- 태그: 태그 버튼 표시
- 액션 버튼: [수정] [삭제]

**하단 영역:**
- [+ 메모 작성하기] 버튼
  - 클릭 시 메모 작성 모달/페이지 표시

---

### 2.2 메모 작성 화면

#### 2.2.1 모달/페이지 레이아웃
```
┌─────────────────────────────────────────┐
│  메모 작성                        [닫기] │
├─────────────────────────────────────────┤
│  책 선택: [드롭다운 ▼]                  │
│  페이지: [____] 페이지                  │
│                                         │
│  메모 내용:                             │
│  ┌───────────────────────────────────┐ │
│  │                                     │ │
│  │  (텍스트 입력 영역)                 │ │
│  │                                     │ │
│  └───────────────────────────────────┘ │
│  (0/5000자)                             │
│                                         │
│  태그:                                  │
│  [태그 입력...] [기존 태그 선택]        │
│  [태그1] [태그2] [태그3]                │
│                                         │
│  메모 시작 시간: [날짜] [시간]          │
│  (기본값: 현재 시간)                    │
│                                         │
│  [취소]  [저장]                         │
└─────────────────────────────────────────┘
```

#### 2.2.2 입력 필드

**책 선택 (필수):**
- 드롭다운 또는 검색 가능한 선택 컴포넌트
- 내 서재에 있는 책만 표시
- 카테고리: "읽는 중인 책", "거의 다 읽은 책"만 표시 (선택적)

**페이지 수 (필수):**
- 숫자 입력 필드
- 최소값: 1
- 최대값: 해당 책의 전체 페이지 수
- 유효성 검사: 숫자만 입력 가능

**메모 내용 (필수):**
- 텍스트 영역 (textarea)
- 최대 5000자
- 실시간 글자 수 표시: (현재/5000자)
- 빈 내용일 경우 저장 불가 (버튼 비활성화)
- 페이지당 최대 15개 제한 체크 (경고 메시지 표시)

**태그 (선택):**
- 태그 입력 필드
  - 자동완성 기능 (기존 태그 제안)
  - 엔터 또는 쉼표로 태그 추가
  - 태그 삭제: X 버튼 클릭
- 기존 태그 선택
  - 인기 태그 또는 최근 사용 태그 표시
  - 클릭하여 추가

**메모 시작 시간 (필수):**
- 날짜 선택: 캘린더 컴포넌트
- 시간 선택: 시간 선택 컴포넌트
- 기본값: 현재 날짜/시간
- 과거 날짜 선택 가능 (과거의 오늘의 흐름 기록)

**액션 버튼:**
- [취소]: 입력 내용 취소 및 모달 닫기
- [저장]: 메모 저장
  - 유효성 검사 통과 시에만 활성화
  - 저장 중 로딩 표시

---

### 2.3 메모 수정 화면

#### 2.3.1 레이아웃
메모 작성 화면과 동일하지만:
- 제목: "메모 수정"
- 기존 값이 입력 필드에 채워져 있음
- [삭제] 버튼 추가

#### 2.3.2 수정 가능 항목
- 페이지 수
- 메모 내용
- 태그 (추가/삭제)
- 메모 시작 시간 (선택적, 변경 가능 여부 결정 필요)

---

### 2.4 책 덮기 화면

#### 2.4.1 모달 레이아웃
```
┌─────────────────────────────────────────┐
│  책 덮기                          [닫기] │
├─────────────────────────────────────────┤
│  📖 [책 제목]                           │
│                                         │
│  마지막으로 읽은 페이지:                │
│  [____] 페이지                          │
│  (전체: 300페이지)                      │
│                                         │
│  진행률: [████████░░] 75%              │
│                                         │
│  ⚠️ 독서 활동을 종료하면 오늘의 흐름에서 │
│     해당 책의 메모가 섹션으로 구분됩니다.│
│                                         │
│  [취소]  [책 덮기]                     │
└─────────────────────────────────────────┘
```

#### 2.4.2 기능
- 마지막 페이지 수 입력
- 진행률 자동 계산 및 표시
- 경고 메시지 표시
- 확인 후 독서 활동 종료

---

## 3. 상호작용 및 UX

### 3.1 메모 작성 플로우

1. **메모 작성 버튼 클릭**
   - 모달 또는 새 페이지 열기
   - 책 선택 드롭다운 포커스

2. **책 선택**
   - 드롭다운에서 책 선택
   - 선택된 책의 전체 페이지 수 표시

3. **페이지 수 입력**
   - 숫자 입력
   - 해당 페이지의 기존 메모 개수 표시 (예: "이 페이지에 3개의 메모가 있습니다")
   - 15개 제한 경고 (14개일 때 경고 표시)

4. **메모 내용 입력**
   - 텍스트 입력
   - 실시간 글자 수 표시
   - 빈 내용일 경우 저장 버튼 비활성화

5. **태그 추가**
   - 태그 입력 또는 기존 태그 선택
   - 태그 미리보기 표시

6. **저장**
   - 유효성 검사
   - API 호출
   - 성공 시 메모 목록에 추가 및 모달 닫기
   - 실패 시 에러 메시지 표시

### 3.2 메모 정렬 및 필터링

#### 3.2.1 타임라인 정렬 (기본값)
- 메모를 `memo_start_time` 기준으로 정렬
- 가장 오래된 메모가 위에 표시
- 시간 표시: "10:30 AM", "오후 2:15" 등

#### 3.2.2 책별 정렬
- 책별로 그룹화
- 각 책 그룹 내에서 시간 순서대로 정렬
- 책 제목으로 섹션 구분

#### 3.2.3 특정 책 필터링
- 책 선택 드롭다운에서 책 선택
- 선택된 책의 메모만 표시
- 필터 해제: "전체" 선택

### 3.3 메모 수정/삭제

#### 3.3.1 메모 수정
- 메모 카드의 [수정] 버튼 클릭
- 수정 모달 열기
- 기존 값 표시
- 수정 후 저장

#### 3.3.2 메모 삭제
- 메모 카드의 [삭제] 버튼 클릭
- 확인 다이얼로그 표시
- 확인 시 삭제 API 호출
- 성공 시 목록에서 제거

### 3.4 과거의 오늘의 흐름 조회

#### 3.4.1 날짜 선택
- 헤더의 날짜 선택 버튼 클릭
- 캘린더 모달 표시
- 날짜 선택
- 선택된 날짜의 메모 조회

#### 3.4.2 독서 캘린더 연동
- 독서 캘린더에서 날짜 클릭
- 해당 날짜의 오늘의 흐름으로 이동
- 날짜 표시: "2024년 1월 15일의 흐름"

---

## 4. 상태 관리

### 4.1 로컬 상태

**메모 목록:**
```typescript
interface MemoListState {
  memos: Memo[];
  loading: boolean;
  error: string | null;
  sortBy: 'TIMELINE' | 'BOOK';
  filterBookId: number | null;
  selectedDate: Date;
}
```

**메모 작성/수정:**
```typescript
interface MemoFormState {
  userBookId: number | null;
  pageNumber: number | null;
  content: string;
  tags: string[];
  memoStartTime: Date;
  isSubmitting: boolean;
}
```

### 4.2 API 호출

**메모 목록 조회:**
```typescript
GET /api/v1/today-flow?date=2024-01-15
GET /api/v1/memos/books/{userBookId}?date=2024-01-15
GET /api/v1/memos/by-book?userBookId={userBookId}
```

**메모 작성:**
```typescript
POST /api/v1/memos
Body: {
  userBookId: number;
  pageNumber: number;
  content: string;
  tags: string[];
  memoStartTime: string; // ISO 8601 format
}
```

**메모 수정:**
```typescript
PUT /api/v1/memos/{memoId}
Body: {
  pageNumber?: number;
  content?: string;
  tags?: string[];
}
```

**메모 삭제:**
```typescript
DELETE /api/v1/memos/{memoId}
```

**책 덮기:**
```typescript
POST /api/v1/memos/books/{userBookId}/close
Body: {
  lastReadPage: number;
}
```

---

## 5. 유효성 검사

### 5.1 클라이언트 측 검사

**메모 작성 시:**
- 책 선택: 필수
- 페이지 수: 필수, 1 이상, 책의 전체 페이지 수 이하
- 메모 내용: 필수, 최대 5000자
- 태그: 선택, 각 태그는 100자 이하
- 메모 시작 시간: 필수

**페이지당 제한:**
- 해당 페이지의 메모 개수 확인
- 14개일 때 경고 표시
- 15개일 때 추가 불가 메시지 표시

### 5.2 에러 처리

**에러 메시지:**
- "책을 찾을 수 없습니다."
- "권한이 없습니다."
- "해당 페이지에는 최대 15개의 메모만 작성할 수 있습니다."
- "메모 내용은 필수입니다."
- "메모를 찾을 수 없습니다."

**에러 표시:**
- 토스트 메시지 또는 인라인 에러 메시지
- 필드별 에러 표시

---

## 6. UI 컴포넌트

### 6.1 메모 카드 컴포넌트

**Props:**
```typescript
interface MemoCardProps {
  memo: MemoResponse;
  onEdit: (memoId: number) => void;
  onDelete: (memoId: number) => void;
}
```

**표시 항목:**
- 책 제목 및 표지 (선택)
- 작성 시간 (포맷: "오전 10:30" 또는 "오후 2:15")
- 페이지 수 ("페이지 15")
- 메모 내용
- 태그 목록
- 수정/삭제 버튼

### 6.2 메모 작성 폼 컴포넌트

**Props:**
```typescript
interface MemoFormProps {
  initialValues?: Partial<MemoFormState>;
  onSubmit: (data: MemoCreateRequest) => Promise<void>;
  onCancel: () => void;
  isEdit?: boolean;
}
```

**기능:**
- 책 선택 드롭다운
- 페이지 수 입력
- 메모 내용 입력 (텍스트 영역)
- 태그 입력 및 선택
- 시간 선택
- 유효성 검사
- 제출 및 취소

### 6.3 태그 입력 컴포넌트

**Props:**
```typescript
interface TagInputProps {
  tags: string[];
  onChange: (tags: string[]) => void;
  suggestions?: string[]; // 기존 태그 목록
}
```

**기능:**
- 태그 입력 (엔터 또는 쉼표로 추가)
- 태그 삭제 (X 버튼)
- 자동완성 (기존 태그 제안)
- 태그 미리보기

### 6.4 날짜 선택 컴포넌트

**Props:**
```typescript
interface DatePickerProps {
  value: Date;
  onChange: (date: Date) => void;
  minDate?: Date;
  maxDate?: Date;
}
```

**기능:**
- 캘린더 표시
- 날짜 선택
- 시간 선택 (메모 시작 시간용)

---

## 7. 애니메이션 및 트랜지션

### 7.1 메모 추가 애니메이션
- 새 메모가 목록에 추가될 때 페이드인 효과
- 스크롤 자동 이동 (새 메모 위치로)

### 7.2 메모 삭제 애니메이션
- 삭제 시 페이드아웃 효과
- 목록 재정렬 애니메이션

### 7.3 정렬 변경 애니메이션
- 정렬 기준 변경 시 부드러운 전환
- 메모 카드 재배치 애니메이션

---

## 8. 반응형 디자인

### 8.1 모바일 화면
- 메모 카드 전체 너비 사용
- 태그는 줄바꿈 처리
- 모달은 전체 화면 또는 하단 시트 형태

### 8.2 태블릿 화면
- 메모 카드 2열 배치 가능
- 사이드바 또는 드로어 사용

### 8.3 데스크톱 화면
- 메모 카드 최대 너비 제한
- 여백 활용
- 호버 효과 추가

---

## 9. 접근성 (Accessibility)

### 9.1 키보드 네비게이션
- Tab 키로 모든 인터랙티브 요소 접근 가능
- Enter 키로 버튼 활성화
- Esc 키로 모달 닫기

### 9.2 스크린 리더 지원
- ARIA 레이블 추가
- 역할(role) 명시
- 상태 변경 알림

### 9.3 색상 대비
- WCAG AA 기준 준수
- 텍스트와 배경 색상 대비 확보

---

## 10. 성능 최적화

### 10.1 가상 스크롤
- 메모가 많을 경우 가상 스크롤 적용
- 보이는 영역만 렌더링

### 10.2 무한 스크롤
- 과거 메모 로드 시 무한 스크롤 고려
- 페이지네이션 또는 커서 기반 로딩

### 10.3 메모이제이션
- 메모 목록 컴포넌트 메모이제이션
- 불필요한 리렌더링 방지

### 10.4 이미지 최적화
- 책 표지 이미지 지연 로딩
- 적절한 이미지 크기 사용

---

## 11. 테스트 시나리오

### 11.1 메모 작성 테스트
1. 메모 작성 버튼 클릭
2. 책 선택
3. 페이지 수 입력
4. 메모 내용 입력
5. 태그 추가
6. 저장 버튼 클릭
7. 메모 목록에 추가 확인

### 11.2 메모 수정 테스트
1. 메모 카드의 수정 버튼 클릭
2. 내용 수정
3. 저장 버튼 클릭
4. 변경사항 반영 확인

### 11.3 메모 삭제 테스트
1. 메모 카드의 삭제 버튼 클릭
2. 확인 다이얼로그에서 확인
3. 메모 목록에서 제거 확인

### 11.4 정렬/필터 테스트
1. 타임라인 정렬 선택
2. 책별 정렬 선택
3. 특정 책 필터 선택
4. 정렬/필터 변경 시 목록 업데이트 확인

### 11.5 과거 기록 조회 테스트
1. 날짜 선택 버튼 클릭
2. 과거 날짜 선택
3. 해당 날짜의 메모 조회 확인

---

## 12. 참고사항

- 백엔드 API 명세는 `MEMO_FEATURE_IMPLEMENTATION_PLAN.md` 참조
- API 응답 형식은 `ApiResponse<T>` 래퍼 사용
- 에러 응답은 `ErrorResponse` 형식
- 인증은 JWT 토큰 사용 (Bearer Token)
- 모든 API 호출은 인증 필요

---

## 13. 향후 개선 사항

1. **메모 검색 기능**
   - 메모 내용 검색
   - 태그별 검색
   - 날짜 범위 검색

2. **메모 통계**
   - 일별 메모 작성 개수
   - 책별 메모 작성 개수
   - 태그별 메모 통계

3. **메모 공유**
   - 메모 공유 기능
   - 공유 링크 생성

4. **메모 내보내기**
   - PDF 내보내기
   - 텍스트 파일 내보내기

5. **오프라인 지원**
   - 오프라인 메모 작성
   - 동기화 기능

